<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>

<h1>ðŸ’³ Payment</h1>

<div class="card" style="max-width:520px;margin:12px auto;">
  <h3 style="text-align:center;margin-top:6px;">Order Summary</h3>
  <p id="bill" style="text-align:center;margin:10px 0;font-weight:800;">Total: â‚¹0</p>

  <div id="items" style="padding:10px;display:grid;gap:10px;"></div>
</div>

<div class="card" style="max-width:520px;margin:12px auto;">
  <h3 style="text-align:center;margin-top:6px;">Pay via UPI</h3>

  <!-- âœ… QR -->
  <img id="qr" alt="UPI QR" />

  <!-- âœ… Pay button (deep link) -->
  <a id="payBtn" href="#">Pay</a>

  <!-- âœ… WhatsApp confirm -->
  <a id="whatsappBtn" href="#" target="_blank">ðŸ“ž WhatsApp: Payment Done</a>

  <p style="text-align:center;font-size:12px;color:#666;margin:10px 12px 0;">
    Note: Payment ke baad screenshot WhatsApp pe bhej dena. Main approve kar dunga âœ…
  </p>
</div>

<div class="card" style="max-width:520px;margin:12px auto;">
  <h3 style="text-align:center;margin-top:6px;">Delivery Details</h3>

  <input id="name" placeholder="Full Name" />
  <input id="phone" placeholder="Phone Number" />
  <input id="address" placeholder="Full Address (House/Street/Area)" />
  <input id="city" placeholder="City (Example: Delhi)" />
  <input id="landmark" placeholder="Landmark (Example: Sarojini Nagar)" />

  <button onclick="placeOrder()">âœ… Place Order</button>

  <p id="orderBox" style="text-align:center;font-weight:800;margin:10px 0;"></p>

  <a href="track.html" id="payBtn" style="background:#673ab7;display:none;" >ðŸ“¦ Track Order</a>
</div>

<script>
  // ====== SETTINGS (TU BAS YAHI FIX RAKH) ======
  const UPI_ID = "priyanshuclothing@fam";
  const WHATSAPP_NUMBER = "584268849301"; // without +

  // ====== CART LOAD ======
  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const itemsDiv = document.getElementById("items");
  const billEl = document.getElementById("bill");

  if(cart.length === 0){
    itemsDiv.innerHTML = `<p style="text-align:center;">Cart empty hai. Pehle shop se product add karo.</p>`;
    document.getElementById("payBtn").style.display = "none";
    document.getElementById("whatsappBtn").style.display = "none";
  }

  // Render items + total
  let total = 0;
  cart.forEach(p => {
    total += Number(p.price || 0);
    itemsDiv.innerHTML += `
      <div style="display:flex;gap:10px;align-items:center;">
        <img src="images/${p.folder}/1.jpg" style="width:64px;height:64px;object-fit:cover;border-radius:10px;">
        <div style="flex:1;">
          <div style="font-weight:800;">${p.name}</div>
          <div style="color:#444;">â‚¹${p.price}</div>
        </div>
      </div>
    `;
  });

  billEl.textContent = `Total: â‚¹${total}`;

  // ====== QR + UPI DEEPLINK ======
  // UPI link: upi://pay?pa=UPI_ID&am=AMOUNT&cu=INR
  const upiLink = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&am=${encodeURIComponent(total)}&cu=INR`;

  // QR generator API (free)
  const qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(upiLink)}`;
  document.getElementById("qr").src = qrURL;

  // Pay button
  const payBtn = document.getElementById("payBtn");
  payBtn.textContent = `Pay â‚¹${total}`;
  payBtn.href = upiLink;

  // WhatsApp button (payment message)
  const waMsg = `Maine â‚¹${total} ka payment kar diya hai. Screenshot bhej raha hun âœ…`;
  document.getElementById("whatsappBtn").href =
    `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(waMsg)}`;

  // ====== ORDER SAVE (Place Order) ======
  function generateOrderId(){
    // ORD + 8 digits
    return "ORD" + Math.floor(10000000 + Math.random()*90000000);
  }

  window.placeOrder = function(){
    if(cart.length === 0){
      alert("Cart empty hai!");
      return;
    }

    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const address = document.getElementById("address").value.trim();
    const city = document.getElementById("city").value.trim();
    const landmark = document.getElementById("landmark").value.trim();

    if(!name || !phone || !address || !city || !landmark){
      alert("Bhai sab details fill kar de ðŸ™‚");
      return;
    }

    const orderId = generateOrderId();

    // orders store as object map { orderId: orderData }
    const orders = JSON.parse(localStorage.getItem("orders")) || {};

    orders[orderId] = {
      orderId,
      name,
      phone,
      address,
      city,
      landmark,
      total,
      items: cart,
      createdAt: Date.now(),
      etaDays: 8
    };

    localStorage.setItem("orders", JSON.stringify(orders));
    localStorage.setItem("lastOrderId", orderId);

    // Optionally clear cart after placing order
    // (Agar tu chahe cart clear ho jaye)
    localStorage.removeItem("cart");

    // Show order id + update WhatsApp msg with orderId + amount
    document.getElementById("orderBox").innerHTML =
      `âœ… Order Placed!<br>Order ID: <span style="color:#1e90ff;">${orderId}</span>`;

    const msg2 =
      `Order ID: ${orderId}\nMaine â‚¹${total} ka payment kar diya hai.\nScreenshot bhej raha hun âœ…\nName: ${name}\nAddress: ${address}, ${landmark}, ${city}`;

    document.getElementById("whatsappBtn").href =
      `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(msg2)}`;

    // Show track button
    const trackBtn = document.querySelector('a[href="track.html"]');
    trackBtn.style.display = "block";

    alert("Order ID generate ho gaya âœ… Ab payment screenshot WhatsApp pe bhej do.");
  }
</script>

</body>
</html>
