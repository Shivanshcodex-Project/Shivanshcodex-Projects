<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Payment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="offerBar">
  Secure UPI Payment <span class="pill">Pay Now</span>
</div>

<header class="header">
  <div class="headerRow container">
    <button class="iconBtn" onclick="openDrawer()">‚ò∞</button>

    <div class="brand">
      <div class="logoDot"></div>
      <div>
        <div style="font-weight:1100">PAYMENT</div>
        <div style="font-size:12px;color:#777;font-weight:900;margin-top:-2px">UPI QR + WhatsApp Confirm</div>
      </div>
    </div>

    <div class="rightIcons">
      <button class="iconBtn" onclick="openMiniCart()" aria-label="Cart">üõí</button>
    </div>
  </div>
</header>

<div id="drawerRoot">
  <div class="drawerOverlay" onclick="closeDrawer()"></div>
  <aside class="drawer">
    <div class="drawerHeader">Menu</div>
    <div class="drawerLinks">
      <a href="index.html">Home <span>‚Ä∫</span></a>
      <a href="shop.html">Shop <span>‚Ä∫</span></a>
      <a href="track.html">Order Tracking <span>‚Ä∫</span></a>
      <a href="customer-care.html">Customer Care <span>‚Ä∫</span></a>
      <a href="return-policy.html">Return Policy <span>‚Ä∫</span></a>
    </div>
  </aside>
</div>

<div class="panel">
  <h2 class="center">üí≥ Order Summary</h2>
  <p class="muted center">Total amount will be shown below</p>

  <div id="items" style="margin-top:12px;display:grid;gap:10px;"></div>

  <div class="total" id="bill">Total: ‚Çπ0</div>
</div>

<div class="panel">
  <h2 class="center">Pay via UPI</h2>
  <p class="muted center">UPI ID: <b>priyanshuclothing@fam</b></p>

  <img id="qr" class="qr" alt="UPI QR" />

  <a class="btn btnPrimary" id="payBtn" href="#">Pay</a>
  <a class="btn btnSoft" id="whatsappBtn" href="#" target="_blank">üìû WhatsApp: Payment Done</a>

  <p class="muted center">Payment ke baad screenshot WhatsApp pe bhej dena ‚úÖ</p>
</div>

<div class="panel">
  <h2 class="center">Delivery Details</h2>
  <p class="muted center">Order ID generate hoga (login nahi chahiye)</p>

  <input id="name" placeholder="Full Name" />
  <input id="phone" placeholder="Phone Number" />
  <input id="address" placeholder="Full Address (House/Street/Area)" />
  <input id="city" placeholder="City (Example: Delhi)" />
  <input id="landmark" placeholder="Landmark (Example: Sarojini Nagar)" />

  <button class="btn btnPrimary" onclick="placeOrder()">‚úÖ Place Order</button>

  <p id="orderBox" class="center" style="font-weight:1100;margin-top:10px;"></p>

  <a class="btn btnSoft" id="trackBtn" href="track.html" style="display:none;">üì¶ Track Order</a>
  <a class="btn btnSoft" href="cart.html">‚¨ÖÔ∏è Back to Cart</a>
</div>

<script src="js/ui.js"></script>
<script>
  function openDrawer(){ document.body.classList.add("drawerOpen"); }
  function closeDrawer(){ document.body.classList.remove("drawerOpen"); }

  const UPI_ID = "priyanshuclothing@fam";
  const WHATSAPP_NUMBER = "584268849301";

  const cart = JSON.parse(localStorage.getItem("cart")) || [];
  const itemsDiv = document.getElementById("items");
  const billEl = document.getElementById("bill");

  if(cart.length === 0){
    itemsDiv.innerHTML = `
      <div class="card" style="padding:12px;">
        <b>Cart empty hai</b>
        <div class="muted">Pehle shop se product add karo.</div>
      </div>
    `;
    document.getElementById("payBtn").style.display = "none";
    document.getElementById("whatsappBtn").style.display = "none";
  }

  let total = 0;
  cart.forEach(p => {
    total += Number(p.price || 0);
    itemsDiv.innerHTML += `
      <div class="card" style="padding:12px;display:flex;gap:10px;align-items:center;">
        <img src="images/${p.folder}/1.jpg" style="width:64px;height:64px;object-fit:cover;border-radius:12px;">
        <div style="flex:1;">
          <div style="font-weight:1100;">${p.name}</div>
          <div class="muted">‚Çπ${p.price}</div>
        </div>
      </div>
    `;
  });

  billEl.textContent = `Total: ‚Çπ${total}`;

  const upiLink = `upi://pay?pa=${encodeURIComponent(UPI_ID)}&am=${encodeURIComponent(total)}&cu=INR`;
  const qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=320x320&data=${encodeURIComponent(upiLink)}`;

  document.getElementById("qr").src = qrURL;

  const payBtn = document.getElementById("payBtn");
  payBtn.textContent = `Pay ‚Çπ${total}`;
  payBtn.href = upiLink;

  function setWhatsApp(text){
    document.getElementById("whatsappBtn").href =
      `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(text)}`;
  }
  setWhatsApp(`Maine ‚Çπ${total} ka payment kar diya hai. Screenshot bhej raha hun ‚úÖ`);

  function generateOrderId(){
    return "ORD" + Math.floor(10000000 + Math.random()*90000000);
  }

  function placeOrder(){
    if(cart.length === 0) return toast("Cart empty");

    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const address = document.getElementById("address").value.trim();
    const city = document.getElementById("city").value.trim();
    const landmark = document.getElementById("landmark").value.trim();

    if(!name || !phone || !address || !city || !landmark){
      return toast("Fill all details");
    }

    const orderId = generateOrderId();
    const orders = JSON.parse(localStorage.getItem("orders")) || {};

    orders[orderId] = {
      orderId, name, phone, address, city, landmark,
      total, items: cart,
      createdAt: Date.now(),
      etaDays: 8
    };

    localStorage.setItem("orders", JSON.stringify(orders));
    localStorage.setItem("lastOrderId", orderId);
    localStorage.removeItem("cart");

    document.getElementById("orderBox").innerHTML =
      `‚úÖ Order Placed!<br>Order ID: <span style="color:#1e90ff;">${orderId}</span>`;

    const msg =
`Order ID: ${orderId}
Maine ‚Çπ${total} ka payment kar diya hai ‚úÖ
Screenshot bhej raha hun.
Name: ${name}
Phone: ${phone}
Address: ${address}, ${landmark}, ${city}`;

    setWhatsApp(msg);

    document.getElementById("trackBtn").style.display = "block";
    toast("Order placed");
  }
  window.placeOrder = placeOrder;
</script>

</body>
</html>
